{"version":3,"sources":["Home.js","Components/Reader/StorySelector.js","Components/Reader/Display.js","Components/Reader/CharacterImage.js","lib/replace.js","Reader.js","Editor.js","App.js","reportWebVitals.js","index.js"],"names":["Home","to","pathname","SelectorWindow","styled","div","Background","ContentBox","Select","select","SelectButton","button","EPSelector","props","stories","story_table","main","filter","s","type","activity","mini_activity","ep_id","story_id","ep","match","groups","value","onChange","selectEP","label","map","id","name","zh_CN","en_US","SubEPSelector","selectIndex","story","index","code","LanguageSelector","choices","lang_name","ja_JP","ko_KR","th_TH","selectLanguage","choice","sort","language","publisher","StorySelector","event","setState","target","a","Axios","get","backend","state","data","length","find","c","this","selected","setSelect","prevProps","onClick","close","selectStory","story_ep","story_index","story_language","React","PureComponent","MainDisplay","DescriptionBlock","DialogBlock","DialogName","DialogText","DecisionBlock","DecisionButton","css","BackgroundImage","img","Description","lines","line","text","lines_nums","Dialog","selectChar","char","Decision","params","options","option","i","values","Disply","decide","decision","prepare","result","background","char_img","tag","image","push","src","j","join","desc_id","last","references","includes","next","name2","focus","CharImage","CharacterImage","sprite","split","SpriteHub","replace","source","translated","tagRE","dialogRE","decisionRE","blankRE","counter","obj","toUpperCase","key","v","trim","temp","forEach","param","search","Main","Nav","NavItems","NavItem","Content","Reader","getStoryData","sIndex","lang","status","file","String","ts","data_source","story_data","window","scrollTo","storyselector","getStoryList","re","sorted","b","name_a","act","parseInt","d","name_b","redirect","redirect_search","showCharImage","location","urlParams","URLSearchParams","getUrlParams","className","Display","toLowerCase","Editor","App","basename","process","exact","path","component","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.52170647.chunk.js","sourcesContent":["import { Redirect } from \"react-router-dom\";\r\n\r\nexport default function Home() {\r\n  return (\r\n    <div>\r\n      <Redirect\r\n        to={{pathname: \"/reader\",}}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import Axios from \"axios\";\r\nimport React from \"react\";\r\nimport styled from \"styled-components\";\r\n\r\nconst SelectorWindow = styled.div`\r\n  height: 100vh;\r\n  width: 100vw;\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  overflow: auto;\r\n`;\r\n\r\nconst Background = styled.div`\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  width: 100%;\r\n  height: 100%;\r\n  position: absolute;\r\n`;\r\n\r\nconst ContentBox = styled.div`\r\n  width: 80%;\r\n  background-color: white;\r\n  margin: 1rem auto;\r\n  padding: 1rem;\r\n  display: flex;\r\n  flex-direction: column;\r\n  position: relative;\r\n`;\r\n\r\nconst Select = styled.select`\r\n  width: 100%;\r\n  margin: 1rem 0;\r\n  padding: 0.25rem;\r\n`;\r\n\r\nconst SelectButton = styled.button`\r\n  background-color: #212121;\r\n  color: white;\r\n  border: solid 1px;\r\n  margin: 1rem 0;\r\n  padding: 0.25rem;\r\n`;\r\n\r\nconst EPSelector = (props) => {\r\n  const stories = props.story_table;\r\n  const main = stories.filter((s) => s.type === `main`);\r\n  const activity = stories.filter((s) => s.type === `activity`);\r\n  const mini_activity = stories.filter((s) => s.type === `mini_activity`);\r\n  const ep_id = (story_id) => {\r\n    const { ep } = story_id.match(/main_(?<ep>[0-9])/).groups;\r\n    return `EP ${ep} : `;\r\n  };\r\n  const select = (\r\n    <Select value={props.value} onChange={props.selectEP}>\r\n      <option value=\"\">Select Episode</option>\r\n      <optgroup label=\"Main Story\">\r\n        {main.map((ep) => (\r\n          <option key={ep.id} value={ep.id}>\r\n            {ep_id(ep.id)} {ep.name.zh_CN}{\" \"}\r\n            {ep.name.en_US ? `(${ep.name.en_US})` : ``}\r\n          </option>\r\n        ))}\r\n      </optgroup>\r\n      <optgroup label=\"Activity Story\">\r\n        {activity.map((ep) => (\r\n          <option key={ep.id} value={ep.id}>\r\n            {ep.name.zh_CN} {ep.name.en_US ? `(${ep.name.en_US})` : ``}\r\n          </option>\r\n        ))}\r\n      </optgroup>\r\n      <optgroup label=\"Mini Activity Story\">\r\n        {mini_activity.map((ep) => (\r\n          <option key={ep.id} value={ep.id}>\r\n            {ep.name.zh_CN} {ep.name.en_US ? `(${ep.name.en_US})` : ``}\r\n          </option>\r\n        ))}\r\n      </optgroup>\r\n    </Select>\r\n  );\r\n  return select;\r\n};\r\n\r\nconst SubEPSelector = (props) => {\r\n  const ep = props.ep;\r\n  const select = (\r\n    <Select value={props.value} onChange={props.selectIndex}>\r\n      <option value=\"\">Select Story</option>\r\n      {ep.story.map((story) => (\r\n        <option key={`${ep.id}_${story.index}`} value={story.index}>\r\n          {story.code ? `${story.code} : ` : ``} {story.name.zh_CN}{\" \"}\r\n          {story.name.en_US ? `(${story.name.en_US})` : ``}\r\n        </option>\r\n      ))}\r\n    </Select>\r\n  );\r\n  return select;\r\n};\r\n\r\nconst LanguageSelector = (props) => {\r\n  const choices = props.choices;\r\n  const lang_name = {\r\n    zh_CN: \"Chinese\",\r\n    en_US: \"English\",\r\n    ja_JP: \"Japanese\",\r\n    ko_KR: \"Korea\",\r\n    th_TH: \"Thai\",\r\n  };\r\n  const select = (\r\n    <Select value={props.value} onChange={props.selectLanguage}>\r\n      <option value=\"\">Select Language</option>\r\n      {choices.map((choice) => (\r\n        <option key={choice.sort} value={choice.sort}>\r\n          {lang_name[choice.language]}\r\n          {` (${choice.publisher})`}\r\n        </option>\r\n      ))}\r\n    </Select>\r\n  );\r\n\r\n  return select;\r\n};\r\n\r\nclass StorySelector extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      ep: ``,\r\n      index: ``,\r\n      language: ``,\r\n      publisher: ``,\r\n      id: ``,\r\n      choices: ``,\r\n    };\r\n  }\r\n\r\n  selectEP = (event) => {\r\n    this.setState({ ep: event.target.value, index: ``, id: `` });\r\n  };\r\n  selectIndex = (event) => {\r\n    this.setState({ index: event.target.value }, async () => {\r\n      if (event.target.value) {\r\n        var data = await Axios.get(\r\n          `${this.props.backend}/story/${this.state.ep}/${this.state.index}`\r\n        );\r\n        if (data.data.length > 0) {\r\n          this.setState({ choices: data.data });\r\n        }\r\n      }\r\n    });\r\n  };\r\n  selectLanguage = (event) => {\r\n    var choice = event.target.value;\r\n    if (choice) {\r\n      var story = this.state.choices.find((c) => c.sort === choice);\r\n      this.setState({\r\n        id: choice,\r\n        language: story.language,\r\n        publisher: story.publisher,\r\n      });\r\n    } else {\r\n      this.setState({ id: `` });\r\n    }\r\n  };\r\n\r\n  setSelect() {\r\n    this.setState(\r\n      {\r\n        ep: this.props.selected.ep || \"\",\r\n        index: this.props.selected.index || \"\",\r\n        language: this.props.selected.language || \"\",\r\n        publisher: this.props.selected.publisher || \"\",\r\n      },\r\n      async () => {\r\n        if (this.state.ep && this.state.index) {\r\n          var data = await Axios.get(\r\n            `${this.props.backend}/story/${this.state.ep}/${this.state.index}`\r\n          );\r\n          if (data.data.length > 0) {\r\n            var choices = data.data;\r\n            var id = `${this.state.ep}_${this.state.index}_${this.state.language}_${this.state.publisher}`\r\n            this.setState({ choices: choices, id: id });\r\n          }\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setSelect();\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.props.selected !== prevProps.selected) {\r\n      this.setSelect();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <SelectorWindow>\r\n        <Background onClick={() => this.props.close()} />\r\n        <ContentBox>\r\n          <EPSelector\r\n            story_table={this.props.story_table}\r\n            value={this.state.ep}\r\n            selectEP={this.selectEP}\r\n          />\r\n          {this.state.ep ? (\r\n            <SubEPSelector\r\n              ep={this.props.story_table.find((ep) => ep.id === this.state.ep)}\r\n              value={this.state.index}\r\n              selectIndex={this.selectIndex}\r\n            />\r\n          ) : (\r\n            <></>\r\n          )}\r\n          {this.state.choices && this.state.index ? (\r\n            <LanguageSelector\r\n              choices={this.state.choices}\r\n              value={this.state.id}\r\n              selectLanguage={this.selectLanguage}\r\n            />\r\n          ) : (\r\n            <></>\r\n          )}\r\n          {this.state.id ? (\r\n            <SelectButton\r\n              onClick={() =>\r\n                this.props.selectStory({\r\n                  story_ep: this.state.ep,\r\n                  story_index: this.state.index,\r\n                  story_language: this.state.language,\r\n                  id: this.state.id,\r\n                  publisher: this.state.publisher,\r\n                })\r\n              }\r\n            >\r\n              Select\r\n            </SelectButton>\r\n          ) : (\r\n            <></>\r\n          )}\r\n        </ContentBox>\r\n      </SelectorWindow>\r\n    );\r\n  }\r\n}\r\n\r\nexport default StorySelector;\r\n","import React from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\n\r\nconst MainDisplay = styled.div``;\r\nconst DescriptionBlock = styled.div`\r\n  margin: 1rem;\r\n  padding: 1rem;\r\n  border: solid black;\r\n  border-width: 0 8px 0 8px;\r\n  color: #ffffff;\r\n  background-color: #212121;\r\n`;\r\n\r\nconst DialogBlock = styled.div`\r\n  color: #ffffff;\r\n  margin: 1rem 0;\r\n`;\r\n\r\nconst DialogName = styled.div`\r\n  padding: 1rem;\r\n  background-color: #212121;\r\n  font-weight: 700;\r\n  width: fit-content;\r\n  cursor:pointer;\r\n  user-select: none;\r\n`;\r\nconst DialogText = styled.div`\r\n  padding: 0 1rem;\r\n`;\r\n\r\nconst DecisionBlock = styled.div`\r\n  display: flex;\r\n  justify-content: space-around;\r\n  margin: 1rem 0;\r\n`;\r\n\r\nconst DecisionButton = styled.div`\r\n  background-color: white;\r\n  display: flex;\r\n  padding: 1rem;\r\n  margin: 0 1rem;\r\n  align-items: center;\r\n  cursor: pointer;\r\n  user-select: none;\r\n  ${(props) =>\r\n    props.selected &&\r\n    css`\r\n      background-color: #212121;\r\n      color: white;\r\n    `}\r\n`;\r\n\r\nconst BackgroundImage = styled.img`\r\n  width: 100%;\r\n  height: auto;\r\n`;\r\n\r\nconst Description = (props) => {\r\n  const lines = props.lines;\r\n  const result = (\r\n    <DescriptionBlock key={props.lines_nums}>\r\n      {lines.map((line) => (\r\n        <p key={line.index}>{line.text}</p>\r\n      ))}\r\n    </DescriptionBlock>\r\n  );\r\n  return result;\r\n};\r\n\r\nconst Dialog = (props) => {\r\n  const lines = props.lines;\r\n  const result = (\r\n    <DialogBlock key={props.lines_nums}>\r\n      <DialogName onClick={()=>props.selectChar(props.char)}>{props.name || `???`}</DialogName>\r\n      <DialogText>\r\n        {lines.map((line) => (\r\n          <p key={line.index}>{line.text}</p>\r\n        ))}\r\n      </DialogText>\r\n    </DialogBlock>\r\n  );\r\n  return result;\r\n};\r\n\r\nconst Decision = (props) => {\r\n  const line = props.line;\r\n  const index = props.index;\r\n  const result = (\r\n    <DecisionBlock key={index}>\r\n      {line.params.options.map((option, i) => (\r\n        <DecisionButton\r\n          key={`${props.index}_${line.params.values[i]}`}\r\n          onClick={() =>\r\n            props.select({ line: props.index, option: line.params.values[i] })\r\n          }\r\n          selected={props.selected === line.params.values[i]}\r\n        >\r\n          {option}\r\n        </DecisionButton>\r\n      ))}\r\n    </DecisionBlock>\r\n  );\r\n  return result;\r\n};\r\n\r\nclass Disply extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      decision: {},\r\n      story: [],\r\n    };\r\n  }\r\n  decide = (params) => {\r\n    var decision = this.state.decision;\r\n    decision[params.line] = params.option;\r\n    this.setState({ decision: decision }, () => this.prepare());\r\n  };\r\n  selectChar = (char) => {\r\n    this.props.selectChar(char)\r\n  }\r\n  prepare = () => {\r\n    var result = [];\r\n    var decision = this.state.decision;\r\n    var background = \"bg_black\";\r\n    var char_img = \"\"\r\n    const story = this.props.story;\r\n    for (var i = 0; i < story.length; i++) {\r\n      var line = story[i];\r\n      switch (line.tag) {\r\n        case `BACKGROUND`:\r\n          if (line.params?.image) {\r\n            result.push(\r\n              <BackgroundImage\r\n                key={i}\r\n                src={`./images/backgrounds/${line.params.image}.png`}\r\n              ></BackgroundImage>\r\n            );\r\n          } else {\r\n            result.push(<BackgroundImage\r\n              key={i}\r\n              src={`./images/backgrounds/bg_black.png`}\r\n            ></BackgroundImage>);\r\n          }\r\n          background = line?.params?.image || \"bg_black\";\r\n          break;\r\n        case `IMAGE`:\r\n          if (line.params?.image) {\r\n            result.push(\r\n              <BackgroundImage\r\n                key={i}\r\n                src={`./images/images/${line.params.image}.png`}\r\n              ></BackgroundImage>\r\n            );\r\n          } else {\r\n            result.push(<BackgroundImage\r\n            key={i}\r\n            src={`./images/backgrounds/${background}.png`}\r\n          ></BackgroundImage>);\r\n          }\r\n          break;\r\n        case `DIALOG`:\r\n          if (line.params?.text) {\r\n            var lines = [{ index: i, text: line.params.text }];\r\n            var lines_nums = [i];\r\n            var j = i + 1;\r\n            while (\r\n              story[j].tag === `DIALOG` &&\r\n              story[j]?.params?.name === line.params.name\r\n            ) {\r\n              lines.push({ index: j, text: story[j].params.text });\r\n              lines_nums.push(j);\r\n              j += 1;\r\n            }\r\n            result.push(\r\n              <Dialog\r\n                key={i}\r\n                lines={lines}\r\n                name={line.params.name}\r\n                lines_nums={lines_nums.join(`;`)}\r\n                char={char_img}\r\n                selectChar={(char)=>this.selectChar(char)}\r\n              ></Dialog>\r\n            );\r\n            i = j - 1;\r\n          }\r\n          break;\r\n        case `DESCRIPTION`:\r\n          lines = [{ index: i, text: line.params.text }];\r\n          j = i + 1;\r\n          var desc_id = [i];\r\n          while (story[j].tag === `DESCRIPTION`) {\r\n            lines.push({ index: j, text: story[j].params.text });\r\n            desc_id.push(j);\r\n            j += 1;\r\n          }\r\n          result.push(\r\n            <Description\r\n              key={i}\r\n              lines={lines}\r\n              lines_nums={desc_id.join(\";\")}\r\n            ></Description>\r\n          );\r\n          i = j - 1;\r\n          break;\r\n        case `DECISION`:\r\n          if (!decision[i]) {\r\n            decision[i] = line.params.values[0];\r\n          }\r\n          decision.last = decision[i];\r\n          result.push(\r\n            <Decision\r\n              key={i}\r\n              line={line}\r\n              index={i}\r\n              selected={decision[i]}\r\n              select={(params) => this.decide(params)}\r\n            ></Decision>\r\n          );\r\n          break;\r\n        case `PREDICATE`:\r\n          var references = line.params.references;\r\n          if (!references.includes(decision.last)) {\r\n            var next = i + 1;\r\n            while (\r\n              story[next].tag !== `PREDICATE` &&\r\n              !story[next].params?.references?.includes(decision.last)\r\n            ) {\r\n              next += 1;\r\n            }\r\n            i = next - 1;\r\n          }\r\n          break;\r\n        case `CHARACTER`:\r\n          if(line.params){\r\n            if(line.params.name2){\r\n              if(line.params.focus === \"1\"){\r\n                char_img = line.params.name\r\n              } else {\r\n                char_img = line.params.name2\r\n              }\r\n            } else {\r\n              char_img = line.params.name\r\n            }\r\n          } else {\r\n            char_img = \"\"\r\n          }\r\n          break;\r\n          default:\r\n          break;\r\n      }\r\n    }\r\n    this.setState({ story: result, decision: decision });\r\n  };\r\n\r\n  componentDidMount() {}\r\n  componentDidUpdate(prevProps) {\r\n    if (this.props.story !== prevProps.story) {\r\n      this.prepare();\r\n    } else {\r\n      if(!this.state.story){\r\n        this.prepare()\r\n      }\r\n    }\r\n  }\r\n  render() {\r\n    return (\r\n      <MainDisplay>\r\n        {this.state.story ? this.state.story.map((line) => line) : <></>}\r\n      </MainDisplay>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Disply;\r\n","import React from \"react\";\r\nimport styled from \"styled-components\";\r\nimport SpriteHub from '../../lib/sprite_list.json'\r\n\r\nconst Background = styled.div`\r\n  height: 100vh;\r\n  width: 100vw;\r\n  top:0;\r\n  left:0;\r\n  position: fixed;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  background-color: rgba(0,0,0,0.5);\r\n  cursor:pointer;\r\n`;\r\nconst CharImage = styled.img`\r\n  width: auto;\r\n  height: 80%;\r\n`;\r\n\r\nfunction CharacterImage(props) {\r\n  var sprite = \"\";\r\n  if (props.char.split(\"#\").length === 1) {\r\n    sprite = SpriteHub[props.char][1].sprite\r\n  } else {\r\n      var [char,i] = props.char.split(\"#\")\r\n    sprite = SpriteHub[char][i].sprite\r\n  }\r\n  return (\r\n    <Background onClick={()=>props.close()}>\r\n      <CharImage src={`./images/characters/${sprite}`}></CharImage>\r\n    </Background>\r\n  );\r\n}\r\n\r\nexport default CharacterImage;\r\n","function replace(source, translated) {\r\n  const tagRE = /\\[(?<tag>.+?)\\((?<params>.*)\\)\\]/;\r\n  const dialogRE = /\\[[Nn]ame=\"(?<name>.*)\"\\](?<text>.*)/;\r\n  const decisionRE = /\\[[dD]ecision\\(options=\"(?<options>.*)\"[,|, ]+values=\"(?<values>.*)\"\\)\\]/;\r\n  const blankRE = /\\[(?<tag>.*)\\]/;\r\n  var counter = {};\r\n\r\n  const lines = source.split(`\\n`);\r\n  for (var tag in translated.data) {\r\n    if (translated.data[tag]) {\r\n      counter[tag] = 0;\r\n    }\r\n  }\r\n\r\n  return lines.map((line) => {\r\n    var obj = {};\r\n    if (line.match(tagRE)) {\r\n      var { tag, params } = line.match(tagRE).groups;\r\n      tag = tag.toUpperCase();\r\n      if (tag === `DECISION`) {\r\n        params = line.match(decisionRE).groups;\r\n        for (let key in params) {\r\n          params[key] = params[key].split(`;`).map((v) => v.trim());\r\n        }\r\n      } else {\r\n        var temp = {};\r\n        params = params.split(`,`);\r\n        if (params.length > 0) {\r\n          params.forEach((param) => {\r\n            param = param.trim();\r\n            if (param.split(`=`).length > 1) {\r\n              var [key, value] = param.split(`=`);\r\n              temp[key] = value.replace(/\"/g, ``);\r\n            }\r\n          });\r\n        }\r\n        params = temp;\r\n        if(tag === `PREDICATE`){\r\n          params.references = params.references.split(';')\r\n        }\r\n      }\r\n      obj = { tag: tag, params: params };\r\n    } else {\r\n      if (line.match(dialogRE)) {\r\n        var { name, text } = line.match(dialogRE).groups;\r\n        if (text.length > 1 && text[0] === \" \") text = text.trim();\r\n        obj = {\r\n          tag: `DIALOG`,\r\n          params: {\r\n            name: name.toUpperCase(),\r\n            text: text,\r\n          },\r\n        };\r\n      } else {\r\n        if (line.match(blankRE)) {\r\n          tag = line.match(blankRE).groups.tag;\r\n          tag = tag.toUpperCase();\r\n          obj = { tag: tag };\r\n        } else {\r\n          if (line.search(\"//\") && line.length > 1 && line[0] !== `[`) {\r\n            obj = {\r\n              tag: `DESCRIPTION`,\r\n              params: {\r\n                text: line,\r\n              },\r\n            };\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (obj.tag in translated.data) {\r\n      if (obj.params) {\r\n        obj.params = {\r\n          ...obj.params,\r\n          ...translated.data[obj.tag][counter[obj.tag]].params,\r\n        };\r\n        counter[obj.tag] += 1;\r\n      }\r\n    }\r\n    return obj;\r\n  });\r\n}\r\nexport default replace","import Axios from \"axios\";\r\nimport React from \"react\";\r\nimport StorySelector from \"./Components/Reader/StorySelector\";\r\nimport Display from \"./Components/Reader/Display\";\r\nimport CharacterImage from \"./Components/Reader/CharacterImage\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport styled from \"styled-components\";\r\nimport replace from \"./lib/replace\";\r\n\r\nconst Home = styled.div`\r\n  background-color: #484848;\r\n  color: white;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n`;\r\n\r\nconst Main = styled.div`\r\n  background-color: #484848;\r\n`;\r\nconst Nav = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);\r\n  background-color: #212121;\r\n  color: #ffffff;\r\n  width: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  height: 64px;\r\n  padding: 0 16px;\r\n`;\r\nconst NavItems = styled.div`\r\n  display: flex;\r\n  justify-content: space-between;\r\n  padding-right: 2rem;\r\n  width: 100%;\r\n`;\r\nconst NavItem = styled.div`\r\n  font-size: 1rem;\r\n  cursor: pointer;\r\n`;\r\nconst Content = styled.div`\r\n  padding-top: 64px;\r\n  overflow-y: auto;\r\n  overflow-x: hidden;\r\n`;\r\n\r\nconst backend =\r\n  process.env.NODE_ENV === \"production\" ? \"https://5s8czbe2jd.execute-api.ap-southeast-1.amazonaws.com\" : \"http://localhost:8080\";\r\nconst assets =\r\n  process.env.NODE_ENV === \"production\" ? \"https://autoonez.github.io/ak-story/\" : \"http://localhost:3000\";\r\n\r\nclass Reader extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      lang: \"\",\r\n      ep: \"\",\r\n      sIndex: \"\",\r\n      publisher: \"\",\r\n      story_data: {},\r\n      story_table: [],\r\n      char_img: \"\",\r\n      story: false,\r\n      storyselector: false,\r\n      redirect: false,\r\n      redirect_search: \"\",\r\n    };\r\n  }\r\n  getUrlParams() {\r\n    const search = this.props.location.search;\r\n    const urlParams = new URLSearchParams(search);\r\n    const params = {\r\n      lang: urlParams.get(\"lang\"),\r\n      ep: urlParams.get(\"ep\"),\r\n      sIndex: urlParams.get(\"sIndex\"),\r\n      publisher: urlParams.get(\"publisher\"),\r\n    };\r\n    this.setState(\r\n      {\r\n        lang: params.lang,\r\n        ep: params.ep,\r\n        sIndex: params.sIndex,\r\n        publisher: params.publisher,\r\n      },\r\n      () => {\r\n        this.getStoryList();\r\n      }\r\n    );\r\n  }\r\n  getStoryData = async () => {\r\n    var data = await Axios.get(\r\n      `${backend}/story/${this.state.ep}/${this.state.sIndex}/${this.state.lang}/${this.state.publisher}`\r\n    );\r\n    if (data.status === 200) {\r\n      var file = \"\";\r\n      this.state.story_table.forEach((ep) => {\r\n        if (ep.id === this.state.ep) {\r\n          ep.story.forEach((s) => {\r\n            if (String(s.index) === String(this.state.sIndex)) {\r\n              file = s.file;\r\n            }\r\n          });\r\n        }\r\n      });\r\n\r\n      const ts = data.data;\r\n      const data_source = await Axios.get(`${assets}/story/${file}.txt`);\r\n      const source = data_source.data;\r\n      const story_data = replace(source,ts)\r\n      this.setState({ story_data: story_data }, () => {\r\n        window.scrollTo(0, 0);\r\n      });\r\n    } else {\r\n      this.setState({ storyselector: true });\r\n    }\r\n  };\r\n  getStoryList = async () => {\r\n    if (this.state.story_table.length === 0) {\r\n      var data = await Axios.get(`${backend}/story`);\r\n      if (data.data?.length > 0) {\r\n        const re = /act(?<act>[0-9]{1,2})d(?<d>[0-9])/;\r\n        var sorted = data.data.sort((a, b) => {\r\n          if (a.type === b.type) {\r\n            if (a.id.match(re) && b.id.match(re)) {\r\n              var name_a = a.id.match(re).groups;\r\n              name_a.act = parseInt(name_a.act);\r\n              name_a.d = parseInt(name_a.d);\r\n              var name_b = b.id.match(re).groups;\r\n              name_b.act = parseInt(name_b.act);\r\n              name_b.d = parseInt(name_b.d);\r\n              if (name_a.act === name_b.act) {\r\n                if (name_a.d < name_b.d) {\r\n                  return -1;\r\n                }\r\n                if (name_a.d > name_b.d) {\r\n                  return 1;\r\n                }\r\n              } else {\r\n                if (name_a.act < name_b.act) {\r\n                  return -1;\r\n                }\r\n                if (name_a.act > name_b.act) {\r\n                  return 1;\r\n                }\r\n              }\r\n            } else {\r\n              if (a.id < b.id) {\r\n                return -1;\r\n              }\r\n              if (a.id > b.id) {\r\n                return 1;\r\n              }\r\n              return 0;\r\n            }\r\n          } else {\r\n            if (a.type > b.type) {\r\n              return -1;\r\n            }\r\n            if (a.type < b.type) {\r\n              return 1;\r\n            }\r\n          }\r\n          return 0;\r\n        });\r\n        this.setState({ story_table: sorted });\r\n      }\r\n    }\r\n    if (\r\n      this.state.ep &&\r\n      this.state.sIndex &&\r\n      this.state.lang &&\r\n      this.state.publisher\r\n    ) {\r\n      this.getStoryData();\r\n    }\r\n  };\r\n  selectStory = (story) => {\r\n    this.setState({\r\n      lang: story.story_language,\r\n      ep: story.story_ep,\r\n      sIndex: story.story_index,\r\n      publisher: story.publisher,\r\n      storyselector: false,\r\n      story: true,\r\n      redirect: true,\r\n      redirect_search: `?ep=${story.story_ep}&sIndex=${story.story_index}&lang=${story.story_language}&publisher=${story.publisher}`,\r\n    });\r\n  };\r\n\r\n  showCharImage = (char) => {\r\n    this.setState({ char_img: char });\r\n  };\r\n  componentDidMount() {\r\n    this.getUrlParams();\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.props.location.search !== prevProps.location.search) {\r\n      this.getUrlParams();\r\n    }\r\n    this.setState({ redirect: false });\r\n  }\r\n  render() {\r\n    return (\r\n      <Main>\r\n        <Nav>\r\n          <NavItems>\r\n            <NavItem\r\n              onClick={() =>\r\n                this.setState({\r\n                  redirect: true,\r\n                  redirect_search: \"\",\r\n                  story: false,\r\n                })\r\n              }\r\n            >\r\n              Arknights Story Reader\r\n            </NavItem>\r\n            <NavItem onClick={() => this.setState({ storyselector: true })}>\r\n              <i className=\"fas fa-bars\"></i>\r\n            </NavItem>\r\n          </NavItems>\r\n        </Nav>\r\n        <Content>\r\n          {this.state.story ? (\r\n            <Display\r\n              story={this.state.story_data}\r\n              selectChar={(char) => this.showCharImage(char)}\r\n            />\r\n          ) : (\r\n            <Home>\r\n              <div>\r\n                <p>Arknights Story Reader (Fan Made)</p>\r\n                <p>Made by Discord: IchiKung#6130</p>\r\n              </div>\r\n            </Home>\r\n          )}\r\n        </Content>\r\n        {this.state.storyselector ? (\r\n          <StorySelector\r\n            backend={backend}\r\n            story_table={this.state.story_table}\r\n            selectStory={(story) => this.selectStory(story)}\r\n            selected={{\r\n              ep: this.state.ep,\r\n              index: this.state.sIndex,\r\n              language: this.state.lang,\r\n              publisher: this.state.publisher,\r\n            }}\r\n            close={() => this.setState({ storyselector: false })}\r\n          ></StorySelector>\r\n        ) : (\r\n          <></>\r\n        )}\r\n        {this.state.redirect ? (\r\n          <Redirect\r\n            to={{\r\n              pathname: \"/reader\",\r\n              search: this.state.redirect_search,\r\n            }}\r\n          />\r\n        ) : (\r\n          <></>\r\n        )}\r\n        {this.state.char_img ? (\r\n          <CharacterImage\r\n            char={this.state.char_img.toLowerCase()}\r\n            close={() => this.setState({ char_img: \"\" })}\r\n          ></CharacterImage>\r\n        ) : (\r\n          <></>\r\n        )}\r\n      </Main>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Reader;\r\n","import React from \"react\";\r\n\r\nclass Editor extends React.PureComponent {\r\n  render() {\r\n    return <div>Editor</div>;\r\n  }\r\n}\r\n\r\nexport default Editor;\r\n","import { HashRouter, Switch, Route } from \"react-router-dom\";\nimport Home from \"./Home\";\nimport Reader from \"./Reader\";\nimport Editor from \"./Editor\";\n\nfunction App() {\n  return (\n    <HashRouter basename={process.env.PUBLIC_URL}>\n      <Switch>\n        <Route exact path={\"/\"} component={Home} />\n        <Route exact path=\"/reader\" component={Reader} />\n        <Route exact path=\"/editor\" component={Editor} />\n      </Switch>\n    </HashRouter>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}